<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ê²½ì°° ì–‘ì„± v0.28</title>
<style>
  :root{
    --bg:#0f172a; --panel:#111827; --card:#1f2937; --text:#e5e7eb;
    --accent:#60a5fa; --accent2:#34d399; --danger:#ef4444; --warn:#f59e0b;
    --grid-gap:12px; --radius:14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(135deg,#0b1022,#0b1e35 60%,#0b1022);
    color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  .wrap{
    max-width:1100px; margin:0 auto; padding:16px;
    display:grid; gap:var(--grid-gap);
    grid-template-columns: 1fr minmax(0,1.2fr) 1fr;
  }
  header{
    grid-column:1 / -1; background:var(--panel); padding:12px 14px; border-radius:var(--radius);
    display:flex; align-items:center; justify-content:space-between;
  }
  header .left{display:flex; gap:10px; align-items:center}
  .badge{background:#0b1224;border:1px solid #1f2b47;color:#9cc2ff;padding:4px 8px;border-radius:999px;font-size:12px}
  .v{opacity:.8}
  .btn{
    border:1px solid #2b364f; background:#10192b; color:#dbeafe; padding:10px 12px; border-radius:10px;
    cursor:pointer; transition:transform .05s ease, background .15s ease, opacity .2s ease; user-select:none;
  }
  .btn:hover{background:#0e213e}
  .btn:active{transform:translateY(1px)}
  .btn[disabled]{opacity:.5; cursor:not-allowed}
  .btn.block{display:block; width:100%}
  .btn.acc{background:#0e2a4e}
  .btn.good{background:#0f2e2a; border-color:#24564c}
  .btn.warn{background:#2a240f; border-color:#5d4b15}
  .btn.dang{background:#2a0f12; border-color:#5d1521}
  .card{
    background:var(--card); border:1px solid #2b364f; border-radius:var(--radius); padding:12px;
  }
  .title{font-size:18px; margin:0 0 8px 0}
  .muted{opacity:.75; font-size:13px}
  .grid{
    display:grid; gap:var(--grid-gap);
    grid-template-columns:1fr;
  }
  @media (min-width:840px){
    .grid-cols-2{grid-template-columns:1fr 1fr}
  }
  /* Left / Center / Right columns */
  .col{display:flex; flex-direction:column; gap:var(--grid-gap)}
  /* Pills & meters */
  .pill{display:inline-flex; gap:8px; align-items:center; background:#0d1426; border:1px solid #1f2b47; padding:6px 10px; border-radius:999px; font-size:13px}
  .hpbar{height:10px; background:#0b1224; border-radius:999px; overflow:hidden; border:1px solid #1e293b}
  .hpbar>span{display:block; height:100%; background:linear-gradient(90deg,#22d3ee,#10b981); width:100%}
  .row{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
  .stack{display:flex; flex-direction:column; gap:8px}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace}
  /* Sections toggle */
  .hide{display:none !important}
  .toast{
    position:fixed; left:50%; transform:translateX(-50%); bottom:18px;
    background:#0b1224; border:1px solid #1f2b47; color:#dbeafe; padding:10px 14px; border-radius:10px;
    opacity:0; pointer-events:none; transition:opacity .2s ease, transform .2s ease;
  }
  .toast.show{opacity:1; transform:translateX(-50%) translateY(-3px)}
  dialog{
    border:none; padding:0; border-radius:14px; overflow:hidden; background:#0b1224; color:#dbeafe;
    border:1px solid #1f2b47; max-width:min(92vw,520px)
  }
  dialog::backdrop{background:rgba(2,6,23,.6)}
  .modal-head{padding:12px 14px; background:#0c162c; border-bottom:1px solid #1f2b47; font-weight:600}
  .modal-body{padding:14px}
  .modal-foot{padding:12px 14px; background:#0c162c; border-top:1px solid #1f2b47; display:flex; gap:8px; justify-content:flex-end}
  .tag{padding:2px 8px; border-radius:999px; border:1px solid #2b364f; background:#0d1426; font-size:12px}
  .log{max-height:240px; overflow:auto; font-size:13px; line-height:1.5; background:#0c1326; border:1px dashed #253352; border-radius:10px; padding:10px}
  a.link{color:#93c5fd; text-decoration:none}
  .hr{height:1px;background:#22304e;margin:8px 0}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="left">
        <span class="badge">ê²½ì°° ì–‘ì„± â€” ì „íˆ¬ ëª¨ë“œ</span>
        <span class="v">v0.28</span>
      </div>
      <div class="row">
        <button class="btn" id="btnHome" onclick="goHome()">â¬…ï¸ ë©”ì¸</button>
        <button class="btn warn" id="btnQuit" onclick="resign()">ì˜ì›ë©´ì§</button>
      </div>
    </header>

    <!-- LEFT: ì‹ ì›/ìƒíƒœ -->
    <section class="col">
      <div class="card">
        <h3 class="title">ì‹ ì› ì„ íƒ</h3>
        <p class="muted">ì„ íƒí•˜ì§€ ì•Šì€ í•­ëª©ì€ ë¬´ì‘ìœ„ë¡œ ì •í•´ì§‘ë‹ˆë‹¤.</p>
        <div class="grid grid-cols-2">
          <div class="stack">
            <label>ì¡°ì§</label>
            <div class="row" id="orgWrap">
              <label class="pill"><input type="radio" name="org" value="ê²½ì°°"> ê²½ì°°</label>
              <label class="pill"><input type="radio" name="org" value="í•´ì–‘ê²½ì°°"> í•´ì–‘ê²½ì°°</label>
            </div>
          </div>
          <div class="stack">
            <label>ì„±ë³„</label>
            <div class="row" id="sexWrap">
              <label class="pill"><input type="radio" name="sex" value="ë‚¨ì"> ë‚¨ì</label>
              <label class="pill"><input type="radio" name="sex" value="ì—¬ì"> ì—¬ì</label>
            </div>
          </div>
          <div class="stack">
            <label>ì‹œì‘ ê³„ê¸‰</label>
            <div class="row" id="rankWrap">
              <label class="pill"><input type="radio" name="rank0" value="ì˜ê²½"> ì˜ê²½</label>
              <label class="pill"><input type="radio" name="rank0" value="ìˆœê²½"> ìˆœê²½</label>
              <label class="pill"><input type="radio" name="rank0" value="ê²½ìœ„"> ê²½ìœ„</label>
            </div>
          </div>
          <div class="stack">
            <label>ì´ë¦„</label>
            <input id="nameInput" class="btn block" placeholder="ì´ë¦„ ì…ë ¥(ì„ íƒ)" />
          </div>
        </div>
        <div class="hr"></div>
        <button class="btn acc block" id="btnStart">ì‹œì‘</button>
      </div>

      <div class="card" id="statusCard" aria-live="polite">
        <h3 class="title">ìƒíƒœ</h3>
        <div class="stack">
          <div class="row">
            <span id="rankTxt" class="tag">â€”</span>
            <span id="orgTxt" class="tag">â€”</span>
            <span id="sexTxt" class="tag">â€”</span>
            <span id="yearTxt" class="tag">ì—°ì°¨ 0</span>
            <span id="cashTxt" class="tag">ğŸ’° 0</span>
            <span id="kitTxt" class="tag">ğŸ§° êµ¬ê¸‰í•¨ 0</span>
          </div>
          <div>
            <div class="row" style="justify-content:space-between">
              <div>â¤ï¸ ì²´ë ¥ <span id="hpLabel">50/50</span></div>
              <div class="mono" id="weaponLabel">ë¬´ê¸°: ì—†ìŒ</div>
            </div>
            <div class="hpbar" aria-hidden="true"><span id="hpBar" style="width:100%"></span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- CENTER: ì „íˆ¬ -->
    <section class="col">
      <div class="card" id="battleCard">
        <h3 class="title">âš”ï¸ ì  ì •ë³´</h3>
        <div class="row">
          <span id="enemyName" class="tag">â€”</span>
          <span class="tag">ì²´ë ¥ <span id="enemyHP">â€”</span></span>
        </div>
        <div class="hr"></div>

        <div class="grid grid-cols-2">
          <button class="btn block" id="btnRoll">ğŸ² êµ´ë¦¬ê¸°</button>
          <button class="btn block" id="btnBaton">ğŸª„ ì‚¼ë‹¨ë´‰ (1)</button>
          <button class="btn block" id="btnShoot">ğŸ”« ê²©ë°œ (ë¬´ê¸°)</button>
          <button class="btn block" id="btnSwap">ğŸ” ë¬´ê¸°ë³€í™˜</button>
        </div>

        <div class="stack" id="suppressing" style="margin-top:8px">
          <div class="title" style="font-size:16px">âš”ï¸ ì œì•• ì¤‘...</div>
          <div class="grid grid-cols-2">
            <div class="card">
              <div class="muted">ë‚˜</div>
              <div class="mono" id="myLast">â€”</div>
            </div>
            <div class="card">
              <div class="muted">ì </div>
              <div class="mono" id="enemyLast">â€”</div>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-2" style="margin-top:8px">
          <button class="btn good block" id="btnMedUse">â¤ï¸+30 (í„´ ì†Œìš”)</button>
          <button class="btn acc block hide" id="btnAfterOpen">âœ… ì œì•• ì™„ë£Œ! ì• í”„í„° ì—´ê¸°</button>
        </div>
      </div>

      <div class="card hide" id="endingCard">
        <h3 class="title">## ì—”ë”©</h3>
        <div id="endingText" class="stack"></div>
        <div class="hr"></div>
        <button class="btn block" onclick="resetGame()">ì‹ ì› ì„ íƒìœ¼ë¡œ</button>
      </div>
    </section>

    <!-- RIGHT: ì• í”„í„° & ìƒì  & ê¸°ë¡ -->
    <section class="col">
      <div class="card" id="afterCard">
        <h3 class="title">ì• í”„í„°</h3>
        <div class="grid grid-cols-2">
          <button class="btn block" id="btnWash">ğŸ§¼ ì”»ê³  ì¶œê·¼</button>
          <button class="btn block" id="btnMedBuy">ğŸ§° êµ¬ê¸‰í•¨ (5)</button>
          <button class="btn block" id="btnMedUse2">ğŸ©¹ ì‚¬ìš© (â¤ï¸+30)</button>
          <button class="btn block" id="btnPromo">ï¸ğŸ–ï¸ ìŠ¹ì§„ë„ì „</button>
        </div>
        <p class="muted" style="margin-top:8px">â€» ì œì•• ì™„ë£Œ í›„ì—ë§Œ ì—°ì°¨ +4ê°œì›”.</p>
      </div>

      <div class="card" id="shopCard">
        <h3 class="title">ë¬´ê¸° êµ¬ë§¤ (ì˜êµ¬)</h3>
        <div class="grid grid-cols-2">
          <button class="btn block" data-weapon="22LR" data-cost="10">22lr ê¶Œì´ (10)</button>
          <button class="btn block" data-weapon="9MM" data-cost="20">9mm ê¶Œì´ (20)</button>
          <button class="btn block" data-weapon="SHOTGUN" data-cost="35">ì—½ì´ (35)</button>
          <button class="btn block" data-weapon="TAZER" data-cost="50">í…Œì´ì €ê±´ (50)</button>
        </div>
      </div>

      <div class="card">
        <h3 class="title">ì´ë ¥ & ë¡œê·¸</h3>
        <div class="log" id="logBox"></div>
      </div>
    </section>
  </div>

  <!-- ìŠ¹ì§„ ëª¨ë‹¬ -->
  <dialog id="promoDlg">
    <div class="modal-head">ğŸ–ï¸ ìŠ¹ì§„ ë„ì „</div>
    <div class="modal-body">
      <div class="stack">
        <div>ì£¼ì‚¬ìœ„ 2ê°œ í•©ì´ <b id="needReq">â€”</b> ì´ìƒì´ë©´ ìŠ¹ì§„</div>
        <div class="row mono"><span id="diceShow">ğŸ² â€”</span></div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn" id="btnRollPromo">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
      <button class="btn" onclick="closePromo()">ì·¨ì†Œ</button>
    </div>
  </dialog>

  <!-- ì•Œë¦¼ ëª¨ë‹¬ -->
  <dialog id="alertDlg">
    <div class="modal-head">ì•Œë¦¼</div>
    <div class="modal-body" id="alertMsg">â€”</div>
    <div class="modal-foot"><button class="btn" onclick="closeAlert()">í™•ì¸</button></div>
  </dialog>

  <div class="toast" id="toast">ì €ì¥ë¨</div>

<script>
(function(){
  const STATE = {
    started:false, locking:false,
    name:"", org:"", sex:"", rank:"â€”", year:0, cash:0, kit:0,
    hp:50, hpMax:50, weapon:null, // weapon: null | 22LR | 9MM | SHOTGUN | TAZER
    enemy:null, afterOpen:false, logs:[], ended:false
  };

  const RANKS = ["ì˜ê²½","ìˆœê²½","ê²½ì¥","ê²½ì‚¬","ê²½ìœ„","ê²½ê°","ê²½ì •","ì¹˜ì•ˆì´ê°"];
  const PROMO_BASE_REQ = { // ìš”êµ¬ì¹˜(2d6) ê¸°ë³¸ ë‚œì´ë„
    "ì˜ê²½":"6","ìˆœê²½":"7","ê²½ì¥":"8","ê²½ì‚¬":"9","ê²½ìœ„":"10","ê²½ê°":"10","ê²½ì •":"11"
  };

  // --- utils ---
  const $ = sel=>document.querySelector(sel);
  const $$ = (sel,root=document)=>Array.from(root.querySelectorAll(sel));
  const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));
  const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
  const log=(t)=>{ STATE.logs.unshift("â€¢ "+t); renderLogs(); };
  const toast=(t)=>{ const el=$("#toast"); el.textContent=t; el.classList.add("show"); setTimeout(()=>el.classList.remove("show"),1600); };
  const alertMsg=(t)=>{ $("#alertMsg").textContent=t; $("#alertDlg").showModal(); };
  const closeAlert=()=>$("#alertDlg").close();
  window.closeAlert=closeAlert;

  // --- navigation placeholders ---
  window.goHome = () => { alertMsg("GitHub Pagesì—ì„œëŠ” index.htmlì— ì—°ê²°í•˜ì„¸ìš”."); };
  window.resign = () => {
    if(!STATE.started || STATE.ended) return;
    endWith("ì˜ì›ë©´ì§","ì˜ì›ë©´ì§ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. ê²½ë ¥ ì´ë ¥ì— ê¸°ë¡í•©ë‹ˆë‹¤.");
  };

  // --- start / reset ---
  const autoPick = (name, opts)=> (opts.find(o=>o.checked)?.value) || (opts[rand(0,opts.length-1)].value);
  const resetEnemy = ()=>{
    STATE.enemy = { name:["ë¶ˆëŸ‰ë°°","í­ì£¼ì","ì ˆë„ë²”","ë‚œë™ì","í•´ìƒí†µí–‰ìœ„ë°˜ì"][rand(0,4)], hp: rand(18,28) };
  };
  const resetGame = ()=>{
    STATE.started=false; STATE.locking=false; STATE.afterOpen=false; STATE.ended=false;
    STATE.name=""; STATE.org=""; STATE.sex=""; STATE.rank="â€”"; STATE.year=0; STATE.cash=0; STATE.kit=0;
    STATE.hpMax=50; STATE.hp=50; STATE.weapon=null; STATE.logs=[];
    resetEnemy(); renderAll();
  };
  window.resetGame = resetGame;

  // Initial
  resetEnemy(); renderAll();

  // --- rendering ---
  function renderAll(){
    // identity/status
    $("#rankTxt").textContent = STATE.rank;
    $("#orgTxt").textContent = STATE.org || "â€”";
    $("#sexTxt").textContent = STATE.sex || "â€”";
    $("#yearTxt").textContent = `ì—°ì°¨ ${STATE.year}`;
    $("#cashTxt").textContent = `ğŸ’° ${STATE.cash}`;
    $("#kitTxt").textContent = `ğŸ§° êµ¬ê¸‰í•¨ ${STATE.kit}`;
    $("#hpLabel").textContent = `${STATE.hp}/${STATE.hpMax}`;
    $("#hpBar").style.width = `${(STATE.hp/STATE.hpMax)*100}%`;
    $("#weaponLabel").textContent = `ë¬´ê¸°: ${STATE.weapon?STATE.weapon:"ì—†ìŒ"}`;

    // enemy
    $("#enemyName").textContent = STATE.enemy?.name ?? "â€”";
    $("#enemyHP").textContent = STATE.enemy? `${STATE.enemy.hp}`: "â€”";

    // after / ending
    $("#btnAfterOpen").classList.toggle("hide", !STATE.afterOpen);
    $("#endingCard").classList.toggle("hide", !STATE.ended);
    $("#battleCard").classList.toggle("hide", STATE.ended);

    // buttons enable
    const inBattle = STATE.started && !STATE.afterOpen && !STATE.ended;
    ["#btnRoll","#btnBaton","#btnShoot","#btnSwap","#btnMedUse"].forEach(id=>{
      $(id).disabled = !inBattle || STATE.locking;
    });
    $("#btnQuit").disabled = !STATE.started || STATE.ended;

    // start button
    $("#btnStart").disabled = STATE.started;
  }
  function renderLogs(){
    $("#logBox").innerHTML = STATE.logs.join("<br>");
  }

  // --- start click ---
  $("#btnStart").addEventListener("click", ()=>{
    const org = autoPick("org", $$("input[name=org]"));
    const sex = autoPick("sex", $$("input[name=sex]"));
    const rank0 = autoPick("rank0", $$("input[name=rank0]"));
    const name = $("#nameInput").value.trim() || ["í™ê¸¸ë™","ê¹€ë¯¼ì¬","ì •ì„¸ë¼","ë°•í•˜ëŠ˜","ì´ë‹´"][rand(0,4)];

    STATE.org = org; STATE.sex = sex; STATE.rank = rank0; STATE.name = name;
    STATE.started = true; STATE.afterOpen=false; STATE.ended=false;
    STATE.hpMax = 50; STATE.hp = 50; STATE.cash = 0; STATE.kit = 0; STATE.year = 0;
    STATE.weapon = null; resetEnemy();
    log(`ì‹œì‘: ${STATE.org} ${STATE.rank} ${STATE.name} (${STATE.sex})`);
    renderAll();
    toast("ê²Œì„ ì‹œì‘");
  });

  // --- battle loop helpers ---
  function lock(ms=300){
    STATE.locking = true; renderAll();
    return new Promise(r=>setTimeout(()=>{ STATE.locking=false; renderAll(); r(); }, ms));
  }
  function takeDamage(n){
    STATE.hp = clamp(STATE.hp - n, 0, STATE.hpMax);
    $("#myLast").textContent = `í”¼í•´ ${n}, ì²´ë ¥ ${STATE.hp}/${STATE.hpMax}`;
    if(STATE.hp<=0){ endWith("ìˆœì§","ì²´ë ¥ì´ 0 ì´í•˜ê°€ ë˜ì–´ ì „íˆ¬ ë¶ˆëŠ¥. ìˆœì§ ì²˜ë¦¬ë©ë‹ˆë‹¤."); }
  }
  function enemyTurn(){
    if(STATE.ended) return;
    const d = rand(1,6)+rand(1,6);
    let dmg = Math.max(1, Math.floor(d/2));
    takeDamage(dmg);
  }
  function endWith(type, text){
    STATE.ended = true;
    const box = $("#endingText");
    box.innerHTML = `<div class="stack"><div class="title">${type}</div><div>${text}</div></div>`;
    log(`ì—”ë”©: ${type}`);
    renderAll();
  }

  // --- actions ---
  $("#btnRoll").addEventListener("click", async ()=>{
    if(!STATE.started || STATE.afterOpen || STATE.ended) return;
    await lock(300);
    const my = rand(1,6)+rand(1,6);
    const en = rand(1,6)+rand(1,6);
    const dealt = Math.max(1, my - 2); // ê¸°ë³¸ í”¼í•´
    STATE.enemy.hp = clamp(STATE.enemy.hp - dealt, 0, 999);
    $("#myLast").textContent = `ì£¼ì‚¬ìœ„ ${my}, ê°€í•œ í”¼í•´ ${dealt}`;
    $("#enemyLast").textContent = `ì£¼ì‚¬ìœ„ ${en}`;
    if(STATE.enemy.hp<=0){
      STATE.afterOpen = true;
      $("#btnAfterOpen").classList.remove("hide");
      log(`ì œì•• ì™„ë£Œ: ${STATE.enemy.name}`);
    }else{
      enemyTurn();
    }
    renderAll();
  });

  $("#btnBaton").addEventListener("click", async ()=>{
    if(!STATE.started || STATE.afterOpen || STATE.ended) return;
    await lock(300);
    const dealt = 1; // ê³ ì • 1
    STATE.enemy.hp = clamp(STATE.enemy.hp - dealt, 0, 999);
    $("#myLast").textContent = `ì‚¼ë‹¨ë´‰ íƒ€ê²©, í”¼í•´ ${dealt}`;
    $("#enemyLast").textContent = `ë°˜ê²© ëŒ€ê¸°`;
    if(STATE.enemy.hp<=0){
      STATE.afterOpen = true;
      log(`ì œì•• ì™„ë£Œ: ${STATE.enemy.name}`);
    }else enemyTurn();
    renderAll();
  });

  $("#btnShoot").addEventListener("click", async ()=>{
    if(!STATE.started || STATE.afterOpen || STATE.ended) return;
    await lock(300);
    const w = STATE.weapon;
    if(!w){ alertMsg("ë¬´ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒì ì—ì„œ êµ¬ë§¤í•˜ì„¸ìš”."); return; }
    const base = { "22LR":[2,5], "9MM":[3,7], "SHOTGUN":[4,9], "TAZER":[0,0] }[w];
    if(w==="TAZER"){
      // í…Œì´ì €: ì  ë‹¤ìŒ ê³µê²© 0, ì¦‰ì‹œ ì œì•• ê²Œì´ì§€ ëŒ€í­
      const dealt = rand(3,6);
      STATE.enemy.hp = clamp(STATE.enemy.hp - dealt, 0, 999);
      $("#myLast").textContent=`í…Œì´ì € ì‚¬ìš©, í”¼í•´ ${dealt} & ì  ê³µê²© ë¬´íš¨`;
      $("#enemyLast").textContent=`ê°ì „ìœ¼ë¡œ í–‰ë™ë¶ˆê°€`;
      if(STATE.enemy.hp<=0){ STATE.afterOpen=true; log(`ì œì•• ì™„ë£Œ: ${STATE.enemy.name}`); }
      renderAll(); return; // ì  í„´ ì—†ìŒ
    }
    const dealt = rand(base[0], base[1]);
    STATE.enemy.hp = clamp(STATE.enemy.hp - dealt, 0, 999);
    $("#myLast").textContent = `${w} ì‚¬ê²©, í”¼í•´ ${dealt}`;
    if(STATE.enemy.hp<=0){ STATE.afterOpen=true; log(`ì œì•• ì™„ë£Œ: ${STATE.enemy.name}`); renderAll(); return; }
    enemyTurn(); renderAll();
  });

  $("#btnSwap").addEventListener("click", ()=>{
    if(!STATE.started || STATE.afterOpen || STATE.ended) return;
    const order=[null,"22LR","9MM","SHOTGUN","TAZER"];
    const idx = (order.indexOf(STATE.weapon)+1) % order.length;
    STATE.weapon = order[idx];
    toast(`ë¬´ê¸°ë³€í™˜: ${STATE.weapon??"ì—†ìŒ"}`); renderAll();
  });

  // êµ¬ê¸‰í•¨: ì „íˆ¬ ì¤‘ ì‚¬ìš© ì‹œ ë‚´ í„´ ì†Œìš” & ì  ê³µê²©ë§Œ í—ˆìš©
  $("#btnMedUse").addEventListener("click", async ()=>{
    if(!STATE.started || STATE.afterOpen || STATE.ended) return;
    if(STATE.kit<=0){ alertMsg("êµ¬ê¸‰í•¨ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
    await lock(300);
    STATE.kit--; heal(30); $("#myLast").textContent=`êµ¬ê¸‰ ì²˜ì¹˜ +30`;
    enemyTurn(); renderAll();
  });

  function heal(n){ STATE.hp = clamp(STATE.hp + n, 0, STATE.hpMax); }

  // ì• í”„í„°
  $("#btnAfterOpen").addEventListener("click", ()=>{
    if(!STATE.afterOpen) return;
    // ì—°ì°¨ +4ê°œì›”(0.3333ë…„)
    STATE.year = +(STATE.year + 0.33).toFixed(2);
    STATE.cash += 3; // ì‚¬ê±´ ì²˜ë¦¬ ì†Œì •ì˜ ìˆ˜ë‹¹
    log(`ì• í”„í„° ì˜¤í”ˆ: ì—°ì°¨ +0.33, ğŸ’°+3`);
    renderAll();
  });

  $("#btnWash").addEventListener("click", ()=>{
    if(!STATE.afterOpen) { alertMsg("ì œì•• ì™„ë£Œ í›„ ê°€ëŠ¥í•©ë‹ˆë‹¤."); return; }
    // ë‹¤ìŒ ì‚¬ê±´
    heal(10);
    resetEnemy(); STATE.afterOpen=false;
    log("ì”»ê³  ì¶œê·¼: ì²´ë ¥ +10, ë‹¤ìŒ ì‚¬ê±´ìœ¼ë¡œ");
    renderAll();
  });

  $("#btnMedBuy").addEventListener("click", ()=>{
    if(!STATE.afterOpen) { alertMsg("ì œì•• ì™„ë£Œ í›„ ê°€ëŠ¥í•©ë‹ˆë‹¤."); return; }
    if(STATE.cash<5){ alertMsg("ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }
    STATE.cash -= 5; STATE.kit += 1; renderAll(); toast("êµ¬ê¸‰í•¨ +1");
  });
  $("#btnMedUse2").addEventListener("click", ()=>{
    if(!STATE.afterOpen){ alertMsg("ì œì•• ì™„ë£Œ í›„ ê°€ëŠ¥í•©ë‹ˆë‹¤."); return; }
    if(STATE.kit<=0){ alertMsg("êµ¬ê¸‰í•¨ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
    STATE.kit--; heal(30); renderAll(); toast("ì²´ë ¥ +30");
  });

  // ìƒì (ì˜êµ¬ ë¬´ê¸°)
  $("#shopCard").addEventListener("click", (e)=>{
    const btn = e.target.closest("button[data-weapon]");
    if(!btn) return;
    const w = btn.dataset.weapon, cost = +btn.dataset.cost;
    if(STATE.cash < cost){ alertMsg("ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }
    STATE.cash -= cost; STATE.weapon = w;
    log(`ë¬´ê¸° êµ¬ë§¤: ${w} (-${cost})`);
    renderAll();
  });

  // ìŠ¹ì§„ ë„ì „: ìš”êµ¬ì¹˜ëŠ” ëª¨ë‹¬ì—ì„œë§Œ ë…¸ì¶œ
  const promoDlg = $("#promoDlg");
  $("#btnPromo").addEventListener("click", ()=>{
    if(!STATE.afterOpen){ alertMsg("ì œì•• ì™„ë£Œ í›„ ê°€ëŠ¥í•©ë‹ˆë‹¤."); return; }
    const need = PROMO_BASE_REQ[STATE.rank] ?? "10";
    $("#needReq").textContent = need;
    $("#diceShow").textContent = "ğŸ² â€”";
    promoDlg.showModal();
  });
  window.closePromo = ()=>promoDlg.close();

  $("#btnRollPromo").addEventListener("click", ()=>{
    const need = +($("#needReq").textContent);
    const d = rand(1,6)+rand(1,6);
    $("#diceShow").textContent = `ğŸ² ${d} (ìš”êµ¬ ${need}+)`;
    if(d>=need){
      // ìŠ¹ì§„
      const idx = Math.min(RANKS.indexOf(STATE.rank)+1, RANKS.length-1);
      const from = STATE.rank, to = RANKS[idx];
      STATE.rank = to; log(`ìŠ¹ì§„: ${from} â†’ ${to}`);
      toast(`ìŠ¹ì§„: ${to}`);
      promoDlg.close();
    }else{
      toast("ìŠ¹ì§„ ì‹¤íŒ¨");
    }
    renderAll();
  });

  // ê³¼ì‰ì§„ì•• í˜ë„í‹° ì˜ˆì‹œ(ì„ íƒ): ì  ì²´ë ¥ì´ ìŒìˆ˜ë¡œ ë–¨ì–´ì§ˆ ìˆ˜ ìˆëŠ” êµ¬ê°„ ì œê±°í–ˆìŒ(0ì—ì„œ ì»·)
  // HP 0 ì´í•˜ ì—”ë”©ì€ takeDamage()ì—ì„œ ì²˜ë¦¬

  // ì ‘ê·¼ì„± ë³´ì¡°
  $("#alertDlg").addEventListener("close", ()=>$("#alertMsg").textContent="â€”");
})();
</script>
</body>
</html>
